<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent CTO</title>
    <link rel="stylesheet" href="/css/dark-theme.css">
    <link rel="stylesheet" href="/static/css/components.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Gauche - Historique et Actions -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Agent CTO</h2>
                <button class="sidebar-toggle" id="sidebarToggle" title="Masquer/Afficher">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
            </div>

            <!-- Nouvelle Conversation -->
            <div class="sidebar-section">
                <button class="new-chat-btn" id="newChatBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Nouvelle conversation
                </button>
            </div>

            <!-- Historique des Conversations -->
            <div class="sidebar-section">
                <h3 class="section-title">Conversations</h3>
                <div class="chat-history" id="chatHistory">
                    <!-- Chargé dynamiquement -->
                </div>
            </div>

            <!-- Actions Rapides -->
            <div class="sidebar-section">
                <h3 class="section-title">Actions</h3>
                <div class="quick-actions">
                    <button class="action-btn" data-action="analyze">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 13h2v8H3v-8zm4-6h2v14H7V7zm4-6h2v20h-2V1zm4 8h2v12h-2V9z"/>
                        </svg>
                        Analyser Projet
                    </button>
                    <button class="action-btn" data-action="create-agent">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        Créer Agent
                    </button>
                    <button class="action-btn" data-action="create-tunnel">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        Créer Tunnel
                    </button>
                    <button class="action-btn" data-action="orchestrate">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                        </svg>
                        Orchestrer
                    </button>
                </div>
            </div>

            <!-- Paramètres -->
            <div class="sidebar-footer">
                <button class="settings-btn" id="settingsBtn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 15a3 3 0 100-6 3 3 0 000 6z"/>
                        <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                    </svg>
                    Paramètres
                </button>
            </div>
        </aside>

        <!-- Zone Chat Principale -->
        <main class="main-chat">
            <header class="chat-header">
                <div class="header-content">
                    <div class="status-wrapper">
                        <button class="mobile-menu-btn" id="mobileMenuBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                            </svg>
                        </button>
                        <span class="status-indicator" id="statusIndicator"></span>
                        <h1 class="chat-title" id="chatTitle">Nouvelle conversation</h1>
                    </div>
                    <div class="header-controls">
                        <button class="control-btn" id="clearChatBtn" title="Effacer la conversation">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                        <button class="control-btn" id="exportChatBtn" title="Exporter la conversation">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z"/>
                                <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </header>
            
            <section class="messages-container" id="messagesContainer">
                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <span class="typing-text">L'agent réfléchit...</span>
                </div>
            </section>
            
            <footer class="input-area">
                <!-- Mode Selector -->
                <div class="mode-selector" id="modeSelector">
                    <button class="mode-btn active" data-mode="chat" title="Mode Chat">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 2H4a2 2 0 00-2 2v12a2 2 0 002 2h4l4 4 4-4h4a2 2 0 002-2V4a2 2 0 00-2-2z"/>
                        </svg>
                    </button>
                    <button class="mode-btn" data-mode="analyze" title="Mode Analyse">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 13h2v8H3v-8zm4-6h2v14H7V7zm4-6h2v20h-2V1zm4 8h2v12h-2V9z"/>
                        </svg>
                    </button>
                    <button class="mode-btn" data-mode="create" title="Mode Création">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                    </button>
                    <button class="mode-btn" data-mode="orchestrate" title="Mode Orchestration">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                        </svg>
                    </button>
                </div>

                <form class="input-form" id="messageForm">
                    <div class="input-wrapper">
                        <div class="input-controls">
                            <button type="button" class="attach-btn" id="attachBtn" title="Joindre un fichier">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66L9.64 16.2a2 2 0 01-2.83-2.83l8.49-8.49"/>
                                </svg>
                            </button>
                        </div>
                        
                        <textarea 
                            id="messageInput" 
                            placeholder="Tapez votre message..." 
                            rows="1"
                            maxlength="4000"
                        ></textarea>
                        
                        <button type="submit" class="send-btn" id="sendButton">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="input-meta">
                        <div class="mode-info" id="modeInfo">
                            Mode: <span id="currentMode">Chat</span>
                        </div>
                        <div class="input-stats">
                            <span class="char-count" id="charCount">0/4000</span>
                            <span class="message-count">Messages: <span id="messageCount">0</span></span>
                            <span class="session-time" id="sessionTime">00:00</span>
                        </div>
                    </div>
                </form>
            </footer>
        </main>
    </div>

    <!-- Modal d'édition de message -->
    <div class="modal" id="editMessageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Modifier le message</h3>
                <button class="modal-close" id="closeEditModal">×</button>
            </div>
            <div class="modal-body">
                <textarea id="editMessageText" rows="4" placeholder="Modifiez votre message..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelEdit">Annuler</button>
                <button class="btn-primary" id="saveEdit">Sauvegarder</button>
            </div>
        </div>
    </div>    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="/static/js/main.js"></script>
</body>
</html>